---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import FadeInSection from '@/components/islands/FadeInSection.tsx';
import { whitepapers, getWhitepaperBySlug } from '@/lib/data/whitepapers';

export function getStaticPaths() {
  return whitepapers.map((paper) => ({ params: { slug: paper.slug } }));
}

const { slug } = Astro.params;
const whitepaper = getWhitepaperBySlug(slug ?? '');

if (!whitepaper) {
  throw new Error(`White paper not found for slug: ${slug}`);
}
---

<BaseLayout
  title={`${whitepaper.title} - Markosh White Papers`}
  description={whitepaper.summary}
  canonical={`https://markosh.com/whitepapers/${whitepaper.slug}/`}
>
  <Header />
  <main>
    <FadeInSection client:visible>
      <section class="bg-secondary">
        <div class="container mx-auto py-10">
          <nav aria-label="Breadcrumb" class="text-sm text-muted-foreground">
            <ol class="flex items-center gap-2">
              <li><a class="hover:text-primary" href="/">Home</a></li>
              <li aria-hidden="true" class="text-muted-foreground/70">/</li>
              <li><a class="hover:text-primary" href="/whitepapers/">White Papers</a></li>
              <li aria-hidden="true" class="text-muted-foreground/70">/</li>
              <li aria-current="page" class="text-foreground">{whitepaper.title}</li>
            </ol>
          </nav>
          <div class="mt-8 max-w-3xl space-y-6">
            <span class="inline-flex rounded-full bg-primary/10 px-4 py-1 text-sm font-semibold text-primary">White Paper</span>
            <h1 class="font-headline text-4xl sm:text-5xl font-extrabold tracking-tight text-foreground">
              {whitepaper.title}
            </h1>
            <p class="text-lg text-muted-foreground">
              {whitepaper.subtitle}
            </p>
          </div>
        </div>
      </section>
    </FadeInSection>

    <FadeInSection client:visible>
      <section class="py-16">
        <div class="container mx-auto grid gap-12 lg:grid-cols-[minmax(0,3fr)_minmax(0,1fr)]">
          <article class="prose prose-slate max-w-none dark:prose-invert">
            <div set:html={whitepaper.content}></div>
          </article>
          <aside class="space-y-6">
            <div class="rounded-3xl border border-border/70 bg-background p-6 shadow-sm">
              <h2 class="font-headline text-lg font-semibold text-foreground">Summary</h2>
              <p class="mt-3 text-sm text-muted-foreground">{whitepaper.summary}</p>
            </div>
            <div class="rounded-3xl border border-border/70 bg-background p-6 shadow-sm">
              <h2 class="font-headline text-lg font-semibold text-foreground">More white papers</h2>
              <ul class="mt-3 space-y-3 text-sm text-primary">
                {whitepapers.filter((paper) => paper.slug !== whitepaper.slug).map((paper) => (
                  <li>
                    <a class="hover:underline" href={`/whitepapers/${paper.slug}/`}>
                      {paper.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </aside>
        </div>
      </section>
    </FadeInSection>
  </main>
  <Footer />
</BaseLayout>
